{"openapi":"3.1.0","info":{"title":"FastAPI","version":"0.1.0"},"paths":{"/medicines/":{"post":{"tags":["medicines"],"summary":"Add a new medicine with its first batch","description":"Adds a new medicine to the inventory.\n\nIf a medicine with the same name already exists, it will raise an error.\nA new medicine must be accompanied by its first batch details.","operationId":"add_new_medicine_medicines__post","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicineCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicinePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["medicines"],"summary":"Get a list of all medicines","description":"Retrieves a paginated list of all medicines with summary inventory data.","operationId":"get_all_medicines_medicines__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MedicineInList"},"title":"Response Get All Medicines Medicines  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/medicines/{medicine_id}":{"get":{"tags":["medicines"],"summary":"Get a single medicine by ID","description":"Retrieves the details of a single medicine, including all its batches.","operationId":"get_medicine_by_id_medicines__medicine_id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"medicine_id","in":"path","required":true,"schema":{"type":"integer","title":"Medicine Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicinePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["medicines"],"summary":"Update a medicine","description":"Update a medicine's details, such as name, category, or selling price.","operationId":"update_medicine_medicines__medicine_id__put","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"medicine_id","in":"path","required":true,"schema":{"type":"integer","title":"Medicine Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicineUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicinePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["medicines"],"summary":"Delete a medicine","description":"Deletes a medicine and all its associated batches from the inventory.","operationId":"delete_medicine_medicines__medicine_id__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"medicine_id","in":"path","required":true,"schema":{"type":"integer","title":"Medicine Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/medicines/{medicine_id}/batches":{"post":{"tags":["medicines"],"summary":"Add a new batch to a medicine","description":"Adds a new batch of stock to an existing medicine.","operationId":"add_new_batch_to_medicine_medicines__medicine_id__batches_post","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"medicine_id","in":"path","required":true,"schema":{"type":"integer","title":"Medicine Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicineBatchCreate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MedicinePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/sales/":{"post":{"tags":["sales"],"summary":"Create a new sale","description":"Processes a new sale transaction.\n\nThis endpoint takes a list of medicines and quantities, validates stock,\nupdates the inventory (decrementing from batches expiring soonest first),\nand records the sale. The entire operation is a single database transaction.","operationId":"create_new_sale_sales__post","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SaleCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SalePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["sales"],"summary":"Get a list of all sales","description":"Retrieves a paginated list of all sales transactions, ordered by the most recent first.","operationId":"get_all_sales_sales__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/SaleInList"},"title":"Response Get All Sales Sales  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/sales/{sale_id}":{"get":{"tags":["sales"],"summary":"Get a single sale by ID","description":"Retrieves the details of a single sale, including all its line items.","operationId":"get_sale_by_id_sales__sale_id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"sale_id","in":"path","required":true,"schema":{"type":"integer","title":"Sale Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SalePublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/dashboard/stats":{"get":{"tags":["dashboard"],"summary":"Get dashboard statistics","description":"Retrieves key performance indicators for the dashboard, such as total\nsales for today and the number of items with low stock.","operationId":"get_dashboard_stats_dashboard_stats_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DashboardStats"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/dashboard/low-stock":{"get":{"tags":["dashboard"],"summary":"Get a report of low-stock items","description":"Retrieves a list of all medicines where the total quantity is at or\nbelow the specified threshold.","operationId":"get_low_stock_report_dashboard_low_stock_get","parameters":[{"name":"threshold","in":"query","required":false,"schema":{"type":"integer","default":10,"title":"Threshold"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/MedicineInList"},"title":"Response Get Low Stock Report Dashboard Low Stock Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/dashboard/expiring-soon":{"get":{"tags":["dashboard"],"summary":"Get a report of batches expiring soon","description":"Retrieves a list of all medicine batches that will expire within the\nspecified number of days.","operationId":"get_expiring_soon_report_dashboard_expiring_soon_get","parameters":[{"name":"days","in":"query","required":false,"schema":{"type":"integer","default":30,"title":"Days"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/ExpiringBatchItem"},"title":"Response Get Expiring Soon Report Dashboard Expiring Soon Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/register":{"post":{"tags":["authentication"],"summary":"Register User","operationId":"register_user_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserPublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/token":{"post":{"tags":["authentication"],"summary":"Login For Access Token","operationId":"login_for_access_token_auth_token_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_for_access_token_auth_token_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/":{"post":{"tags":["users"],"summary":"Create a new user (Admin only)","description":"Create a new user with a specified role. This endpoint is restricted to admins.","operationId":"create_user_by_admin_users__post","security":[{"OAuth2PasswordBearer":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreateWithRole"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserPublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"get":{"tags":["users"],"summary":"Get a list of all users (Admin only)","description":"Retrieve a paginated list of all users.","operationId":"get_all_users_users__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"skip","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Skip"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserPublic"},"title":"Response Get All Users Users  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/{user_id}":{"get":{"tags":["users"],"summary":"Get a single user by ID (Admin only)","description":"Retrieve the details of a single user.","operationId":"get_user_by_id_users__user_id__get","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserPublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"put":{"tags":["users"],"summary":"Update a user (Admin only)","description":"Update a user's details, such as their username or role.","operationId":"update_user_users__user_id__put","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserPublic"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["users"],"summary":"Delete a user (Admin only)","description":"Delete a user from the system.","operationId":"delete_user_users__user_id__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"user_id","in":"path","required":true,"schema":{"type":"integer","title":"User Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_login_for_access_token_auth_token_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"^password$"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","format":"password","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"format":"password","title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_for_access_token_auth_token_post"},"Category":{"type":"string","enum":["painkiller","antibiotic","supplement","antibacterial","antiseptic","other"],"title":"Category","description":"Represents a category of medicine"},"DashboardStats":{"properties":{"total_sales_today":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Total Sales Today"},"total_medicines":{"type":"integer","title":"Total Medicines"},"low_stock_items_count":{"type":"integer","title":"Low Stock Items Count"}},"type":"object","required":["total_sales_today","total_medicines","low_stock_items_count"],"title":"DashboardStats"},"ExpiringBatchItem":{"properties":{"medicine_id":{"type":"integer","title":"Medicine Id"},"medicine_name":{"type":"string","title":"Medicine Name"},"batch_id":{"type":"integer","title":"Batch Id"},"batch_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Number"},"expiry_date":{"type":"string","format":"date","title":"Expiry Date"},"quantity_remaining":{"type":"integer","title":"Quantity Remaining"}},"type":"object","required":["medicine_id","medicine_name","batch_id","batch_number","expiry_date","quantity_remaining"],"title":"ExpiringBatchItem"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"MedicineBatchCreate":{"properties":{"batch_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Number"},"expiry_date":{"type":"string","format":"date","title":"Expiry Date"},"cost_price":{"anyOf":[{"type":"number","minimum":0.0},{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"}],"title":"Cost Price"},"quantity":{"type":"integer","exclusiveMinimum":0.0,"title":"Quantity","description":"The initial quantity of the batch, must be positive."}},"type":"object","required":["expiry_date","cost_price","quantity"],"title":"MedicineBatchCreate"},"MedicineBatchPublic":{"properties":{"batch_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Batch Number"},"expiry_date":{"type":"string","format":"date","title":"Expiry Date"},"cost_price":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Cost Price"},"id":{"type":"integer","title":"Id"},"date_added":{"type":"string","format":"date-time","title":"Date Added"},"is_expired":{"type":"boolean","title":"Is Expired"},"quantity":{"type":"integer","minimum":0.0,"title":"Quantity","description":"The current quantity of the batch."}},"type":"object","required":["expiry_date","cost_price","id","date_added","is_expired","quantity"],"title":"MedicineBatchPublic"},"MedicineCreate":{"properties":{"name":{"type":"string","title":"Name"},"category":{"$ref":"#/components/schemas/Category","default":"other"},"selling_price":{"anyOf":[{"type":"number","minimum":0.0},{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"}],"title":"Selling Price"},"batch":{"$ref":"#/components/schemas/MedicineBatchCreate"}},"type":"object","required":["name","selling_price","batch"],"title":"MedicineCreate"},"MedicineInList":{"properties":{"name":{"type":"string","title":"Name"},"category":{"$ref":"#/components/schemas/Category","default":"other"},"selling_price":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Selling Price"},"id":{"type":"integer","title":"Id"},"total_quantity":{"type":"integer","title":"Total Quantity"},"earliest_expiry":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Earliest Expiry"}},"type":"object","required":["name","selling_price","id","total_quantity","earliest_expiry"],"title":"MedicineInList"},"MedicinePublic":{"properties":{"name":{"type":"string","title":"Name"},"category":{"$ref":"#/components/schemas/Category","default":"other"},"selling_price":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Selling Price"},"id":{"type":"integer","title":"Id"},"batches":{"items":{"$ref":"#/components/schemas/MedicineBatchPublic"},"type":"array","title":"Batches","default":[]},"total_quantity":{"type":"integer","title":"Total Quantity"},"earliest_expiry":{"anyOf":[{"type":"string","format":"date"},{"type":"null"}],"title":"Earliest Expiry"}},"type":"object","required":["name","selling_price","id","total_quantity","earliest_expiry"],"title":"MedicinePublic"},"MedicineUpdate":{"properties":{"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"category":{"anyOf":[{"$ref":"#/components/schemas/Category"},{"type":"null"}]},"selling_price":{"anyOf":[{"type":"number","minimum":0.0},{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$"},{"type":"null"}],"title":"Selling Price"}},"type":"object","title":"MedicineUpdate"},"SaleCreate":{"properties":{"items":{"items":{"$ref":"#/components/schemas/SaleItemCreate"},"type":"array","minItems":1,"title":"Items"}},"type":"object","required":["items"],"title":"SaleCreate"},"SaleInList":{"properties":{"id":{"type":"integer","title":"Id"},"sale_date":{"type":"string","format":"date-time","title":"Sale Date"},"total_amount":{"type":"number","title":"Total Amount"}},"type":"object","required":["id","sale_date","total_amount"],"title":"SaleInList"},"SaleItemCreate":{"properties":{"medicine_id":{"type":"integer","title":"Medicine Id"},"quantity":{"type":"integer","exclusiveMinimum":0.0,"title":"Quantity"}},"type":"object","required":["medicine_id","quantity"],"title":"SaleItemCreate"},"SaleItemPublic":{"properties":{"medicine_id":{"type":"integer","title":"Medicine Id"},"quantity":{"type":"integer","exclusiveMinimum":0.0,"title":"Quantity"},"id":{"type":"integer","title":"Id"},"price_per_unit":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Price Per Unit"},"medicine_name":{"type":"string","title":"Medicine Name","readOnly":true}},"type":"object","required":["medicine_id","quantity","id","price_per_unit","medicine_name"],"title":"SaleItemPublic"},"SalePublic":{"properties":{"id":{"type":"integer","title":"Id"},"sale_date":{"type":"string","format":"date-time","title":"Sale Date"},"total_amount":{"type":"string","pattern":"^(?!^[-+.]*$)[+-]?0*\\d*\\.?\\d*$","title":"Total Amount"},"items":{"items":{"$ref":"#/components/schemas/SaleItemPublic"},"type":"array","title":"Items"}},"type":"object","required":["id","sale_date","total_amount","items"],"title":"SalePublic"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"UserCreate":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"}},"type":"object","required":["username","password"],"title":"UserCreate"},"UserCreateWithRole":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"},"role":{"$ref":"#/components/schemas/UserRole","default":"seller"}},"type":"object","required":["username","password"],"title":"UserCreateWithRole"},"UserPublic":{"properties":{"username":{"type":"string","title":"Username"},"id":{"type":"integer","title":"Id"},"role":{"$ref":"#/components/schemas/UserRole"}},"type":"object","required":["username","id","role"],"title":"UserPublic"},"UserRole":{"type":"string","enum":["admin","seller"],"title":"UserRole"},"UserUpdate":{"properties":{"username":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Username"},"role":{"anyOf":[{"$ref":"#/components/schemas/UserRole"},{"type":"null"}]}},"type":"object","title":"UserUpdate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/auth/token"}}}}}}